<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ V2.0</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --main-color: #008080; /* Ø§Ù„ØªØ±ÙƒÙˆØ§Ø² Ø§Ù„Ø£ØµÙ„ÙŠ */
            --gold-color: #D4AF37; /* Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
            --bg-color: #f4f4f4;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px; text-align: center;
        }
        .container { max-width: 500px; margin: auto; }
        h1 { color: var(--main-color); }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙƒÙ…Ø§ ÙÙŠ ØªØ·Ø¨ÙŠÙ‚Ùƒ */
        .card {
            background: white; border-radius: 15px;
            padding: 15px; margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-right: 5px solid var(--gold-color);
        }
        .btn-main {
            background-color: var(--main-color);
            color: white; border: none; padding: 12px 25px;
            border-radius: 25px; cursor: pointer; font-size: 16px;
            width: 100%; transition: 0.3s; margin-top: 10px;
        }
        .btn-main:active { transform: scale(0.95); }

        /* Ø§Ù„Ù…Ø°ÙƒØ±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© */
        .task-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px; border-bottom: 1px solid #eee;
        }
        .task-item input { transform: scale(1.5); cursor: pointer; }

        /* Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ… */
        #daily-verse { font-style: italic; color: #555; line-height: 1.6; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸŒ™ Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ V2.0</h1>

    <div class="card">
        <h3>âœ¨ Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</h3>
        <p id="daily-verse">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        <small id="verse-ref" style="color: var(--gold-color)"></small>
    </div>

    <div class="card">
        <h3>ğŸ“ Ù…Ø°ÙƒØ±Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</h3>
        <div id="checklist">
            <div class="task-item"><span>ØµÙ„Ø§Ø© Ø§Ù„ÙØ¬Ø±</span> <input type="checkbox" onchange="saveTask(0)"></div>
            <div class="task-item"><span>ÙˆØ±Ø¯ Ø§Ù„Ù‚Ø±Ø¢Ù†</span> <input type="checkbox" onchange="saveTask(1)"></div>
            <div class="task-item"><span>Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­</span> <input type="checkbox" onchange="saveTask(2)"></div>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ“¿ Ø§Ù„Ù…Ø³Ø¨Ø­Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</h3>
        <h2 id="counter-display" style="color: var(--main-color)">0</h2>
        <button class="btn-main" onclick="incrementTasbih()">Ø³Ø¨Ù‘Ø­ Ø§Ù„Ø¢Ù†</button>
        <button onclick="resetCounter()" style="background:none; border:none; color:red; cursor:pointer; margin-top:10px;">ØªØµÙÙŠØ±</button>
    </div>
</div>

<script>
    // 1. Ø¨ÙŠØ§Ù†Ø§Øª Ø¢ÙŠØ© Ø§Ù„ÙŠÙˆÙ…
    const verses = [
        {t: "ÙˆÙØ§Ø³Ù’ØªÙØ¹ÙÙŠÙ†ÙÙˆØ§ Ø¨ÙØ§Ù„ØµÙÙ‘Ø¨Ù’Ø±Ù ÙˆÙØ§Ù„ØµÙÙ‘Ù„ÙØ§Ø©Ù", r: "Ø§Ù„Ø¨Ù‚Ø±Ø©: 45"},
        {t: "ÙŠÙØ§ Ø£ÙÙŠÙÙ‘Ù‡ÙØ§ Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø¢Ù…ÙÙ†ÙÙˆØ§ ÙƒÙØªÙØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù Ø§Ù„ØµÙÙ‘ÙŠÙØ§Ù…Ù", r: "Ø§Ù„Ø¨Ù‚Ø±Ø©: 183"},
        {t: "ÙˆÙØ¥ÙØ°ÙØ§ Ø³ÙØ£ÙÙ„ÙÙƒÙ Ø¹ÙØ¨ÙØ§Ø¯ÙÙŠ Ø¹ÙÙ†ÙÙ‘ÙŠ ÙÙØ¥ÙÙ†ÙÙ‘ÙŠ Ù‚ÙØ±ÙÙŠØ¨ÙŒ", r: "Ø§Ù„Ø¨Ù‚Ø±Ø©: 186"}
    ];

    // 2. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    window.onload = () => {
        loadDailyVerse();
        loadProgress();
        registerSW();
        // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„ØµÙˆØª
        if (Notification.permission !== 'granted') Notification.requestPermission();
    };

    function loadDailyVerse() {
        const day = new Date().getDate() % verses.length;
        document.getElementById('daily-verse').innerText = verses[day].t;
        document.getElementById('verse-ref').innerText = verses[day].r;
    }

    // 3. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø³Ø¨Ø­Ø© Ù…Ø¹ Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø²
    let count = localStorage.getItem('count') || 0;
    document.getElementById('counter-display').innerText = count;

    function incrementTasbih() {
        count++;
        document.getElementById('counter-display').innerText = count;
        localStorage.setItem('count', count);
        if (navigator.vibrate) navigator.vibrate(50); // Ø§Ù‡ØªØ²Ø§Ø² Ø¨Ø³ÙŠØ·
    }

    function resetCounter() {
        count = 0;
        document.getElementById('counter-display').innerText = 0;
        localStorage.setItem('count', 0);
    }

    // 4. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø°ÙƒØ±Ø© (Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠ)
    function saveTask(index) {
        let tasks = JSON.parse(localStorage.getItem('userTasks')) || [false, false, false];
        const checkboxes = document.querySelectorAll('#checklist input');
        tasks[index] = checkboxes[index].checked;
        localStorage.setItem('userTasks', JSON.stringify(tasks));
    }

    function loadProgress() {
        let tasks = JSON.parse(localStorage.getItem('userTasks')) || [false, false, false];
        const checkboxes = document.querySelectorAll('#checklist input');
        tasks.forEach((status, i) => { if(checkboxes[i]) checkboxes[i].checked = status; });
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker
    async function registerSW() {
        if ('serviceWorker' in navigator) {
            try { await navigator.serviceWorker.register('sw.js'); } 
            catch (e) { console.log('SW registration failed'); }
        }
    }
</script>
</body>
</html>
