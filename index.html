<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISKAR - ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</title>

    <meta property="og:title" content="ISKAR - ØªØ·Ø¨ÙŠÙ‚Ùƒ Ø§Ù„Ø±Ù…Ø¶Ø§Ù†ÙŠ">
    <meta property="og:image" content="https://dogc7717-boop.github.io/Ramadan/cover.jpg">
    <meta property="og:description" content="Ù…Ø³Ø¨Ø­Ø©ØŒ Ù…ÙˆØ§Ù‚ÙŠØª ØµÙ„Ø§Ø©ØŒ ÙˆØ£Ø°ÙƒØ§Ø± Ù…ØªØ¬Ø¯Ø¯Ø© Ø¹Ø¨Ø± ØªÙ„ÙŠØ¬Ø±Ø§Ù….">

    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --gold: #B8860B;
            --neon: 0 0 20px rgba(184, 134, 11, 0.7);
            --glass: rgba(255, 255, 255, 0.08);
        }

        body {
            background: #0a0e17 url('cover.jpg') no-repeat center center fixed;
            background-size: cover;
            color: white; margin: 0; font-family: 'Segoe UI', sans-serif;
            text-align: center; overflow-x: hidden;
        }

        .glass-panel {
            background: rgba(10, 14, 23, 0.85);
            backdrop-filter: blur(15px);
            border: 1px solid var(--gold);
            border-radius: 25px;
            box-shadow: var(--neon);
            padding: 20px;
            margin: 10px auto;
            width: 90%;
        }

        /* Ø§Ù„Ù…Ø³Ø¨Ø­Ø© */
        .circular-counter {
            width: 190px; height: 190px; border-radius: 50%;
            border: 6px solid var(--gold); margin: 20px auto;
            display: flex; align-items: center; justify-content: center;
            font-size: 4rem; box-shadow: var(--neon); cursor: pointer;
            background: var(--glass); transition: 0.2s;
        }

        .btn-neon {
            background: var(--gold); color: white; border: none; padding: 10px 15px;
            border-radius: 12px; cursor: pointer; font-weight: bold; box-shadow: var(--neon);
            margin: 5px; font-size: 0.9rem;
        }

        /* Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ø¨ÙŠØ­ */
        #historyLog { max-height: 120px; overflow-y: auto; margin-top: 15px; font-size: 0.85rem; }
        .log-item { display: flex; justify-content: space-between; padding: 5px; border-bottom: 1px solid rgba(184,134,11,0.2); }

        /* Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: rgba(0,0,0,0.9);
            display: flex; justify-content: space-around; padding: 15px 0;
            border-top: 1px solid var(--gold); z-index: 1000;
        }
        .nav-bar span { cursor: pointer; color: var(--gold); font-weight: bold; }
        .nav-bar span.active { color: #fff; text-shadow: var(--neon); }

        .page { padding: 40px 10px 120px; display: none; animation: fadeIn 0.4s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        td { padding: 12px; border-bottom: 1px solid rgba(184,134,11,0.2); }
    </style>
</head>
<body>

    <header style="padding:15px; background:rgba(0,0,0,0.8); color:var(--gold); font-weight:bold; border-bottom: 1px solid var(--gold);">ISKAR</header>

    <main>
        <section id="tasbihPage" class="page" style="display: block;">
            <div class="circular-counter" onclick="handleTasbih()">
                <span id="displayNum">0</span>
            </div>
            <h3 id="tasbihType" style="color: var(--gold);">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</h3>
            <div>
                <button class="btn-neon" onclick="setMode('Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡')">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</button>
                <button class="btn-neon" onclick="setMode('Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡')">Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡</button>
                <button class="btn-neon" onclick="setMode('Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±')">Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</button>
            </div>
            <button onclick="resetCounter()" style="background:none; border:1px solid red; color:red; border-radius:10px; margin-top:10px; cursor:pointer;">ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ ğŸ”„</button>
            
            <div id="historyLog" class="glass-panel">
                <div id="logItems"><p>Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¨ÙŠØ­ Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„Ø³Ø¬Ù„ Ù‡Ù†Ø§</p></div>
            </div>

            <div style="margin-top:15px;">
                ğŸ”Š <input type="checkbox" id="soundToggle" checked> 
                ğŸ“³ <input type="checkbox" id="vibrateToggle" checked>
            </div>
        </section>

        <section id="prayerPage" class="page">
            <div class="glass-panel">
                <select id="citySelect" onchange="getPrayerTimes()" style="width:100%; padding:10px; background:#000; color:var(--gold); border:1px solid var(--gold); border-radius:10px;">
                    <option value="Cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©</option>
                    <option value="Alexandria">Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©</option>
                    <option value="Mansoura">Ø§Ù„Ù…Ù†ØµÙˆØ±Ø©</option>
                    <option value="Mecca">Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©</option>
                </select>
                <table id="prayerTable"></table>
            </div>
            <div class="glass-panel">
                <p>ØµÙˆØª Ø§Ù„Ø£Ø°Ø§Ù†:</p>
                <select id="voiceSelect" onchange="saveVoice()" style="background:#000; color:#fff; padding:5px; border:1px solid var(--gold);">
                    <option value="Egypt.mp3">Egyptian 1</option>
                    <option value="Egypt_1.mp3">Egyptian 2</option>
                </select>
            </div>
        </section>

        <section id="azkarPage" class="page">
            <div id="azkarContainer"></div>
        </section>
    </main>

    <nav class="nav-bar">
        <span id="navTasbih" class="active" onclick="showPage('tasbih')">Ø§Ù„Ù…Ø³Ø¨Ø­Ø©</span>
        <span id="navPrayer" onclick="showPage('prayer')">Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª</span>
        <span id="navAzkar" onclick="showPage('azkar')">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</span>
    </nav>

    <script>
        let count = 0, currentMode = "Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡";

        function showPage(p) {
            document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
            document.querySelectorAll('.nav-bar span').forEach(s => s.classList.remove('active'));
            document.getElementById(p + 'Page').style.display = 'block';
            document.getElementById('nav' + p.charAt(0).toUpperCase() + p.slice(1)).classList.add('active');
            if(p === 'azkar') loadAzkar();
            if(p === 'prayer') getPrayerTimes();
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø³Ø¨Ø­Ø© ÙˆØ§Ù„Ø³Ø¬Ù„ ---
        function setMode(m) { if(count > 0) recordResult(); currentMode = m; document.getElementById('tasbihType').innerText = m; count = 0; updateDisplay(); }
        function handleTasbih() {
            count++; updateDisplay();
            if(document.getElementById('vibrateToggle').checked) navigator.vibrate(50);
            if(document.getElementById('soundToggle').checked) new Audio('https://www.soundjay.com/buttons/sounds/button-16.mp3').play().catch(()=>{});
        }
        function resetCounter() { if(count > 0) recordResult(); count = 0; updateDisplay(); }
        function updateDisplay() { document.getElementById('displayNum').innerText = count; }
        function recordResult() {
            const log = document.getElementById('logItems');
            if(log.innerHTML.includes("Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ³Ø¨ÙŠØ­")) log.innerHTML = "";
            const div = document.createElement('div'); div.className = 'log-item';
            div.innerHTML = `<span>${currentMode}</span> <b>${count}</b>`;
            log.prepend(div);
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥Ù…Ø³Ø§ÙƒÙŠØ© (Online/Offline) ---
        async function getPrayerTimes() {
            const city = document.getElementById('citySelect').value;
            const table = document.getElementById('prayerTable');
            try {
                const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Egypt&method=4`);
                const data = await res.json();
                const t = data.data.timings;
                localStorage.setItem('iskar_offline_data', JSON.stringify(t));
                renderTable(t);
            } catch {
                const cached = JSON.parse(localStorage.getItem('iskar_offline_data'));
                if(cached) renderTable(cached);
                else table.innerHTML = "<tr><td>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£ÙˆÙ„ Ù…Ø±Ø©</td></tr>";
            }
        }
        function renderTable(t) {
            document.getElementById('prayerTable').innerHTML = `
                <tr><td>Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ</td><td>${t.Imsak}</td></tr>
                <tr><td>Ø§Ù„ÙØ¬Ø±</td><td>${t.Fajr}</td></tr>
                <tr><td>Ø§Ù„Ù…ØºØ±Ø¨</td><td>${t.Maghrib}</td></tr>
            `;
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØªØ­Ø¯ÙŠØ« ØªÙ„ÙŠØ¬Ø±Ø§Ù… (Ù…Ø±ØªØ¨Ø· Ø¨Ù…Ù„Ù azkar_dynamic.json Ø§Ù„Ù†Ø§ØªØ¬ Ø¹Ù† Ø§Ù„Ù€ YAML) ---
        async function loadAzkar() {
            let azkar = ["Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø­Ù…Ø¯Ù‡", "Ø£Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…", "Ø§Ù„Ù„Ù‡Ù… ØµÙ„Ù Ø¹Ù„Ù‰ Ù…Ø­Ù…Ø¯", "Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡", "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡"];
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ø°ÙƒØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ ÙˆØ¶Ø¹Ù‡ Ø§Ù„Ù€ Github Action ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù
                const res = await fetch('azkar_dynamic.json');
                if(res.ok) {
                    const data = await res.json();
                    if(data.newZikr) azkar.unshift("ğŸ“¢ Ø°ÙƒØ± Ø¬Ø¯ÙŠØ¯ Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…: " + data.newZikr);
                }
            } catch(e) {}
            document.getElementById('azkarContainer').innerHTML = azkar.map(z => `
                <div class="glass-panel" style="text-align:right; border-right:4px solid var(--gold);">${z}</div>
            `).join('');
        }

        function saveVoice() { localStorage.setItem('userVoice', document.getElementById('voiceSelect').value); }
        
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }
        window.onload = () => { 
            const savedV = localStorage.getItem('userVoice');
            if(savedV) document.getElementById('voiceSelect').value = savedV;
        };
    </script>
</body>
        </html>
